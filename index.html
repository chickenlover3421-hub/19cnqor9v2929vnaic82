<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Network</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        primary: '#6366f1', 
                        primaryDark: '#4f46e5',
                        dark: '#0f172a',    
                        card: '#1e293b',    
                        input: '#334155',    
                        danger: '#ef4444',
                        success: '#22c55e'
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; scroll-behavior: smooth; }
        .nav-btn.active { color: #6366f1; background: rgba(99, 102, 241, 0.1); border-right: 3px solid #6366f1; }
        .animate-slide { animation: slideUp 0.4s ease-out forwards; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .notification-toast { animation: slideInRight 0.3s ease-out forwards; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .video-card:hover iframe { transform: scale(1.05); }
        iframe { transition: transform 0.3s ease; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- --- NOTIFICATION SYSTEM --- -->
    <div id="notification-container" class="fixed top-6 right-6 z-[200] flex flex-col gap-3 w-80"></div>

    <!-- --- AUTH SCREEN --- -->
    <div id="auth-screen" class="fixed inset-0 z-[100] bg-dark flex items-center justify-center p-4">
        <div class="w-full max-w-md animate-slide">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-primary/10 text-primary rounded-3xl flex items-center justify-center mx-auto mb-6 border border-primary/20 shadow-2xl shadow-primary/10">
                    <i class="ph-fill ph-planet text-5xl"></i>
                </div>
                <h1 class="text-4xl font-bold tracking-tight mb-2">The Network</h1>
                <p class="text-slate-500 font-medium" id="auth-desc">Connect. Share. Explore.</p>
            </div>

            <div class="bg-card p-10 rounded-[2.5rem] border border-slate-700/50 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-50"></div>
                
                <form id="auth-form" onsubmit="event.preventDefault(); Auth.handleSubmit();" class="space-y-5">
                    <div id="auth-error" class="hidden p-4 bg-danger/10 border border-danger/20 text-danger text-xs font-bold rounded-2xl text-center"></div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">Username</label>
                        <input type="text" id="auth-username" required class="w-full bg-slate-900 border border-slate-700/50 rounded-2xl p-4 focus:ring-2 focus:ring-primary outline-none transition text-white placeholder-slate-600" placeholder="Enter username">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">Password</label>
                        <input type="password" id="auth-password" required class="w-full bg-slate-900 border border-slate-700/50 rounded-2xl p-4 focus:ring-2 focus:ring-primary outline-none transition text-white placeholder-••••••••">
                    </div>
                    <button type="submit" id="auth-btn" class="w-full bg-primary hover:bg-primaryDark text-white font-bold py-4 rounded-2xl shadow-xl shadow-primary/20 transition transform active:scale-[0.98]">
                        Log In
                    </button>
                </form>

                <div class="mt-8 pt-6 border-t border-slate-800 flex flex-col items-center gap-4">
                    <button onclick="Auth.toggleMode()" id="auth-toggle" class="text-xs text-slate-500 hover:text-white transition font-bold">
                        New here? <span class="text-primary">Create an Account</span>
                    </button>
                </div>
            </div>
            <p class="text-center mt-8 text-[10px] text-slate-600">v6.0.0 // Groups Update</p>
        </div>
    </div>

    <!-- --- APP LAYOUT --- -->
    <div id="app-screen" class="hidden min-h-screen flex bg-dark">
        
        <!-- SIDEBAR -->
        <aside class="w-72 border-r border-slate-800/50 flex flex-col fixed h-full bg-dark/80 backdrop-blur-xl z-40">
            <div class="p-8 flex items-center gap-4">
                <div class="w-10 h-10 bg-gradient-to-br from-primary to-indigo-700 rounded-xl flex items-center justify-center text-white shadow-lg">
                    <i class="ph-bold ph-globe text-2xl"></i>
                </div>
                <div>
                    <span class="block font-bold text-xl tracking-tight">The Network</span>
                    <span class="block text-[10px] text-primary font-bold uppercase tracking-widest leading-none">Online</span>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-2">
                <p class="px-4 text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-2">Menu</p>
                <button onclick="UI.switchView('feed')" class="nav-btn active w-full flex items-center gap-4 px-4 py-4 text-slate-400 rounded-2xl hover:bg-slate-800/50 hover:text-white transition group">
                    <i class="ph-fill ph-house text-2xl group-hover:scale-110 transition"></i> 
                    <span class="font-medium">Home Feed</span>
                </button>
                <button onclick="UI.switchView('groups'); Group.renderMyGroups();" class="nav-btn w-full flex items-center gap-4 px-4 py-4 text-slate-400 rounded-2xl hover:bg-slate-800/50 hover:text-white transition group">
                    <i class="ph-fill ph-users-three text-2xl group-hover:scale-110 transition text-indigo-400"></i> 
                    <span class="font-medium">Groups</span>
                </button>
                <button onclick="UI.switchView('messages'); Chat.init();" class="nav-btn w-full flex items-center gap-4 px-4 py-4 text-slate-400 rounded-2xl hover:bg-slate-800/50 hover:text-white transition group">
                    <i class="ph-fill ph-chat-circle-dots text-2xl group-hover:scale-110 transition"></i> 
                    <span class="font-medium">Messages</span>
                </button>
                <button onclick="UI.switchView('seameed')" class="nav-btn w-full flex items-center gap-4 px-4 py-4 text-slate-400 rounded-2xl hover:bg-slate-800/50 hover:text-white transition group">
                    <i class="ph-fill ph-film-strip text-2xl group-hover:scale-110 transition text-pink-500"></i> 
                    <span class="font-medium">Seameed</span>
                </button>
                
                <div id="admin-nav-section" class="hidden pt-6">
                    <p class="px-4 text-[10px] font-bold text-danger/60 uppercase tracking-widest mb-2">System</p>
                    <button onclick="UI.switchView('admin')" class="w-full flex items-center gap-4 px-4 py-4 text-danger/70 rounded-2xl hover:bg-danger/10 hover:text-danger transition group">
                        <i class="ph-fill ph-shield-warning text-2xl group-hover:rotate-12 transition"></i> 
                        <span class="font-bold">Admin Panel</span>
                    </button>
                </div>
            </nav>

            <div class="p-6 mt-auto">
                <div onclick="UI.showProfile(Auth.currentUser.username)" class="flex items-center gap-4 p-4 bg-slate-800/30 rounded-[1.5rem] border border-slate-700/30 cursor-pointer hover:border-primary/50 transition group">
                    <div id="sidebar-avatar" class="w-12 h-12 rounded-2xl bg-primary flex items-center justify-center font-bold text-white text-xl shadow-lg shadow-primary/20 group-hover:scale-105 transition">?</div>
                    <div class="flex-1 overflow-hidden">
                        <div id="sidebar-username" class="font-bold text-sm truncate">User</div>
                        <div class="flex items-center gap-1.5">
                            <span class="w-2 h-2 bg-success rounded-full animate-pulse"></span>
                            <span class="text-[10px] text-slate-500 font-bold uppercase">Online</span>
                        </div>
                    </div>
                    <button onclick="event.stopPropagation(); Auth.logout()" class="text-slate-600 hover:text-danger p-2 transition" title="Log Out">
                        <i class="ph-bold ph-sign-out text-xl"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- MAIN AREA -->
        <main class="flex-1 ml-72 flex flex-col min-h-screen">
            
            <header class="h-20 border-b border-slate-800/50 flex items-center justify-between px-10 sticky top-0 bg-dark/80 backdrop-blur-xl z-30">
                <div><h2 id="page-title" class="text-xl font-bold tracking-tight">Home Feed</h2></div>
                <div class="flex items-center gap-4">
                    <button class="p-2.5 text-slate-400 hover:text-white bg-slate-800/50 rounded-xl transition relative">
                        <i class="ph ph-bell text-2xl"></i>
                        <span class="absolute top-2 right-2 w-2 h-2 bg-primary rounded-full animate-pulse"></span>
                    </button>
                </div>
            </header>

            <div id="content-area" class="flex-1 overflow-y-auto">
                
                <!-- VIEW: FEED -->
                <div id="view-feed" class="view-section p-10 max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 animate-slide">
                    <div class="lg:col-span-2 space-y-8">
                        <div class="bg-card p-6 rounded-[2rem] border border-slate-700/50 shadow-xl">
                            <div class="flex gap-4">
                                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-primary to-indigo-600 flex-shrink-0 flex items-center justify-center font-bold text-white text-xl"><i class="ph-fill ph-pencil-simple"></i></div>
                                <div class="flex-1"><textarea id="post-input" placeholder="What's on your mind?" class="w-full bg-transparent border-none focus:ring-0 text-lg resize-none mt-2 h-20 placeholder-slate-600" maxlength="280"></textarea></div>
                            </div>
                            <div class="flex justify-between items-center mt-4 pt-4 border-t border-slate-800/50">
                                <div class="flex gap-2"><button class="p-2 text-slate-400 hover:text-primary rounded-xl"><i class="ph ph-image text-xl"></i></button></div>
                                <button onclick="App.createPost()" class="bg-primary hover:bg-primaryDark text-white px-6 py-2 rounded-xl font-bold shadow-lg transition active:scale-95 text-sm">Post</button>
                            </div>
                        </div>
                        <div id="feed-container" class="space-y-6 pb-32"></div>
                    </div>
                    <div class="hidden lg:block space-y-6">
                        <div class="bg-card/50 p-6 rounded-[2rem] border border-slate-700/50">
                            <h3 class="font-bold text-lg mb-4">Trending</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between group cursor-pointer"><div><p class="text-xs text-slate-500">Groups</p><p class="font-bold text-sm text-white group-hover:text-primary">#BirdWatchers</p></div><span class="text-xs text-slate-600">New</span></div>
                                <div class="flex justify-between group cursor-pointer"><div><p class="text-xs text-slate-500">Viral</p><p class="font-bold text-sm text-white group-hover:text-primary">Seameed Clips</p></div><span class="text-xs text-slate-600">12k</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: GROUPS -->
                <div id="view-groups" class="view-section hidden h-[calc(100vh-80px)] flex animate-slide">
                    <!-- Left: My Groups List -->
                    <div class="w-72 bg-slate-900/50 border-r border-slate-800/50 flex flex-col">
                        <div class="p-6 border-b border-slate-800/50 flex justify-between items-center">
                            <h3 class="font-bold text-lg">My Groups</h3>
                            <button onclick="Group.showCreateModal()" class="text-primary hover:bg-primary/10 p-2 rounded-lg"><i class="ph-bold ph-plus"></i></button>
                        </div>
                        <div id="groups-list" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
                        <div class="p-4 border-t border-slate-800/50">
                            <button onclick="Group.showJoinModal()" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3 rounded-xl transition text-xs uppercase tracking-widest">Discover / Join</button>
                        </div>
                    </div>

                    <!-- Middle: Channels (Hidden if no group selected) -->
                    <div id="group-channels-pane" class="w-60 bg-slate-900/30 border-r border-slate-800/50 flex-col hidden">
                        <div class="p-6 h-20 border-b border-slate-800/50 flex items-center">
                            <h3 id="active-group-name" class="font-bold text-white truncate">Group Name</h3>
                        </div>
                        <div id="group-channels-list" class="flex-1 overflow-y-auto p-3 space-y-1"></div>
                    </div>

                    <!-- Right: Chat Area -->
                    <div class="flex-1 flex flex-col bg-dark/40 relative">
                        <div id="group-empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600">
                            <i class="ph-fill ph-users-three text-6xl mb-4 opacity-20"></i>
                            <p class="font-bold uppercase tracking-widest text-xs">Select a group to begin</p>
                        </div>
                        
                        <div id="group-chat-area" class="flex-1 flex flex-col hidden z-10">
                            <div class="h-16 border-b border-slate-800/50 flex items-center px-6 bg-dark/60">
                                <span class="text-slate-400 mr-2 text-xl">#</span>
                                <span id="active-channel-name" class="font-bold text-white">general</span>
                            </div>
                            <div id="group-messages" class="flex-1 overflow-y-auto p-6 space-y-4"></div>
                            <div class="p-6 bg-dark/60 border-t border-slate-800/50">
                                <div class="flex gap-2 bg-slate-900 border border-slate-700 rounded-xl p-2">
                                    <input type="text" id="group-input" class="flex-1 bg-transparent border-none focus:ring-0 text-white" placeholder="Message group...">
                                    <button onclick="Group.sendMessage()" class="text-primary hover:text-white p-2"><i class="ph-fill ph-paper-plane-right text-xl"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: MESSAGES -->
                <div id="view-messages" class="view-section hidden h-[calc(100vh-80px)] flex animate-slide">
                    <div class="w-80 border-r border-slate-800/50 flex flex-col bg-slate-900/20">
                        <div class="p-6 border-b border-slate-800/50">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="font-bold text-lg">Direct Messages</h3>
                                <button onclick="Chat.toggleGroupMode()" id="group-mode-btn" class="text-xs bg-primary/10 text-primary border border-primary/20 px-3 py-1.5 rounded-lg font-bold hover:bg-primary hover:text-white transition">New Chat</button>
                            </div>
                            <input type="text" id="chat-user-search" placeholder="Search people..." class="w-full bg-slate-800/50 rounded-xl p-3 text-xs border-none focus:ring-1 focus:ring-primary">
                        </div>
                        <div id="chat-user-list" class="flex-1 overflow-y-auto"></div>
                        <div id="chat-group-confirm" class="hidden p-6 bg-primary/5 border-t border-primary/10">
                            <p class="text-[10px] text-primary uppercase font-bold tracking-widest mb-3">Selected:</p>
                            <div id="selected-group-users" class="flex flex-wrap gap-2 mb-4"></div>
                            <button onclick="Chat.startGroup()" class="w-full bg-primary text-white text-xs font-bold py-3 rounded-xl">Create DM Group</button>
                        </div>
                    </div>
                    <div class="flex-1 flex flex-col bg-dark/40 relative">
                        <div id="chat-empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600">
                            <i class="ph-fill ph-chat-circle-dots text-5xl opacity-20"></i>
                            <p class="font-medium text-sm text-slate-500 mt-4">Start a conversation</p>
                        </div>
                        <div id="chat-active-window" class="flex-1 flex flex-col hidden z-10">
                            <div class="h-20 border-b border-slate-800/50 flex items-center px-10 bg-dark/60 justify-between">
                                <div class="flex items-center gap-4">
                                    <div id="chat-target-avatar" class="w-10 h-10 rounded-xl bg-primary flex items-center justify-center text-sm font-bold text-white shadow-lg">?</div>
                                    <div><span id="chat-target-name" class="font-bold text-sm">User</span></div>
                                </div>
                            </div>
                            <div id="chat-messages-container" class="flex-1 overflow-y-auto p-10 flex flex-col space-y-6"></div>
                            <div class="p-8 border-t border-slate-800/50 bg-dark/60">
                                <div class="flex gap-4 items-center bg-slate-900/50 p-2 rounded-2xl border border-slate-700/50">
                                    <input type="text" id="chat-input" placeholder="Type a message..." class="flex-1 bg-transparent border-none text-white focus:ring-0 text-sm px-2 font-medium">
                                    <button onclick="Chat.sendMessage()" class="bg-primary text-white w-12 h-12 rounded-xl flex items-center justify-center hover:bg-primaryDark transition shadow-lg"><i class="ph-fill ph-paper-plane-right text-xl"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: ADMIN -->
                <div id="view-admin" class="view-section hidden p-10 animate-slide">
                    <div class="max-w-6xl mx-auto space-y-8">
                        <div class="flex justify-between items-end border-b border-danger/20 pb-6">
                            <div><h2 class="text-4xl font-black text-danger tracking-tight">ADMIN PANEL</h2><p class="text-slate-500 text-xs mt-2 uppercase tracking-widest">Authorized Personnel: admin</p></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div class="lg:col-span-1 space-y-6">
                                <div class="bg-card/50 border border-primary/30 rounded-[2rem] overflow-hidden">
                                    <div class="p-6 bg-primary/10 border-b border-primary/20"><h3 class="font-bold text-xs text-primary uppercase tracking-widest">Approvals</h3></div>
                                    <div id="admin-approvals-list" class="p-4 space-y-3 max-h-[400px] overflow-y-auto"></div>
                                </div>
                                <div class="bg-card/50 border border-slate-700/50 rounded-[2rem] overflow-hidden">
                                    <div class="p-6 bg-slate-800/50 border-b border-slate-700/50"><h3 class="font-bold text-xs text-white uppercase tracking-widest">Network Groups</h3></div>
                                    <div id="admin-groups-list" class="p-4 space-y-3 max-h-[400px] overflow-y-auto"></div>
                                </div>
                            </div>
                            <div class="lg:col-span-2 bg-card/50 border border-slate-700/50 rounded-[2.5rem] overflow-hidden">
                                <div class="p-6 bg-slate-800/50 border-b border-slate-700/50 font-bold flex justify-between items-center">
                                    <span class="uppercase tracking-widest text-xs">User Registry</span>
                                    <input type="text" placeholder="Search user..." class="bg-slate-900 border border-slate-700 px-4 py-1.5 rounded-xl text-[10px] w-48 focus:border-primary outline-none transition">
                                </div>
                                <div id="admin-user-list" class="divide-y divide-slate-800/50 overflow-y-auto max-h-[600px]"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: PROFILE -->
                <div id="view-profile" class="view-section hidden animate-slide">
                    <div id="profile-header-bg" class="h-64 bg-gradient-to-r from-primary/30 via-indigo-900/40 to-dark relative overflow-hidden"></div>
                    <div class="max-w-5xl mx-auto px-10 -mt-24 pb-20">
                        <div class="flex items-end justify-between mb-12">
                            <div class="flex items-end gap-8">
                                <div id="profile-avatar" class="w-44 h-44 rounded-[3rem] bg-dark border-[8px] border-dark flex items-center justify-center text-6xl font-bold text-white shadow-2xl relative z-10">?</div>
                                <div class="mb-4 z-10">
                                    <div class="flex items-center gap-3"><h2 id="profile-username" class="text-5xl font-black text-white tracking-tight">Username</h2><div id="profile-badge" class="hidden px-3 py-1 bg-primary/20 text-primary border border-primary/30 rounded-full text-[10px] font-bold uppercase tracking-widest">Admin</div></div>
                                </div>
                            </div>
                            <div id="profile-actions" class="mb-4 flex flex-col gap-3 items-end"></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                            <div class="space-y-8">
                                <div class="bg-card/40 p-8 rounded-[2rem] border border-slate-700/50 space-y-6">
                                    <div><h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">About</h4><p id="profile-bio" class="text-slate-300 text-sm leading-relaxed">No bio yet.</p></div>
                                    <div class="flex gap-4 border-t border-slate-800 pt-6">
                                        <div class="flex-1 text-center"><div id="count-followers" class="text-xl font-bold text-white">0</div><div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Followers</div></div>
                                        <div class="w-px bg-slate-800"></div>
                                        <div class="flex-1 text-center"><div id="count-following" class="text-xl font-bold text-white">0</div><div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Following</div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-2 space-y-8">
                                <div class="flex gap-10 border-b border-slate-800">
                                    <button onclick="UI.toggleProfileTab('posts')" id="tab-posts" class="pb-4 text-white font-bold uppercase tracking-widest text-xs border-b-2 border-primary transition">Posts</button>
                                    <button onclick="UI.toggleProfileTab('seameed')" id="tab-seameed" class="pb-4 text-slate-500 font-bold uppercase tracking-widest text-xs border-b-2 border-transparent hover:text-white transition">Media</button>
                                </div>
                                <div id="profile-posts" class="space-y-8"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SEAMEED -->
                <div id="view-seameed" class="view-section hidden p-8 animate-slide">
                    <div class="max-w-7xl mx-auto space-y-8">
                        <div class="text-center mb-10"><h2 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-500 tracking-tight">Seameed</h2></div>
                        <div id="seameed-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Search Overlay -->
    <div id="search-panel" class="fixed inset-0 z-50 bg-dark/95 backdrop-blur-3xl transition-transform duration-700 transform -translate-y-full flex flex-col items-center p-20">
        <button onclick="UI.toggleSearch(false)" class="absolute top-10 right-10 text-slate-500 hover:text-white transition"><i class="ph ph-x text-5xl"></i></button>
        <div class="w-full max-w-4xl"><input type="text" id="search-input" oninput="App.search(this.value)" placeholder="Search the network..." class="w-full bg-transparent border-b-8 border-slate-800 text-6xl font-bold tracking-tight focus:border-primary transition outline-none py-10"><div id="search-results" class="mt-20 grid grid-cols-1 md:grid-cols-2 gap-8"></div></div>
    </div>

    <script>
        // --- DATA STORE ---
        const DB = {
            getUsers: () => JSON.parse(localStorage.getItem('net_v6_users')) || [],
            saveUsers: (u) => localStorage.setItem('net_v6_users', JSON.stringify(u)),
            getPosts: () => JSON.parse(localStorage.getItem('net_v6_posts')) || [],
            savePosts: (p) => localStorage.setItem('net_v6_posts', JSON.stringify(p)),
            getChats: () => JSON.parse(localStorage.getItem('net_v6_chats')) || [],
            saveChats: (c) => localStorage.setItem('net_v6_chats', JSON.stringify(c)),
            getGroups: () => JSON.parse(localStorage.getItem('net_v6_groups')) || [],
            saveGroups: (g) => localStorage.setItem('net_v6_groups', JSON.stringify(g))
        };

        // --- AUTH LOGIC ---
        const Auth = {
            currentUser: null,
            isSignUp: false,

            toggleMode: () => {
                Auth.isSignUp = !Auth.isSignUp;
                document.getElementById('auth-btn').innerText = Auth.isSignUp ? 'Create Account' : 'Log In';
                document.getElementById('auth-toggle').innerHTML = Auth.isSignUp ? 'Already have an account? <span class="text-primary">Log In</span>' : 'New here? <span class="text-primary">Create Account</span>';
            },

            recoverAdmin: () => {
                const users = DB.getUsers();
                let admin = users.find(u => u.username === 'admin');
                if (!admin) {
                    admin = { username: 'admin', password: 'admin123', isAdmin: true, isBanned: false, isApproved: true, joined: Date.now(), followers: [], following: [], bio: "Root Admin", posts: [] };
                    users.push(admin);
                } else {
                    admin.password = 'admin123';
                    admin.isAdmin = true;
                }
                DB.saveUsers(users);
                UI.notify(`Admin reset: User 'admin', Pass 'admin123'`, "success");
            },

            handleSubmit: () => {
                const u = document.getElementById('auth-username').value.trim();
                const p = document.getElementById('auth-password').value;
                const err = document.getElementById('auth-error');
                err.classList.add('hidden');

                const users = DB.getUsers();
                
                // Hardcoded Admin Check
                if (u === 'admin' && p === 'admin123') {
                    let admin = users.find(user => user.username === 'admin');
                    if (!admin) {
                        admin = { username: 'admin', password: 'admin123', isAdmin: true, isBanned: false, isApproved: true, joined: Date.now(), followers: [], following: [], bio: "Root Admin", posts: [] };
                        users.push(admin);
                        DB.saveUsers(users);
                    }
                    Auth.currentUser = admin;
                    Auth.login();
                    return;
                }

                if (Auth.isSignUp) {
                    if (users.find(x => x.username.toLowerCase() === u.toLowerCase())) {
                        err.innerText = "Username taken";
                        err.classList.remove('hidden');
                        return;
                    }
                    const newUser = {
                        username: u, password: p,
                        isAdmin: false, isBanned: false, banExpires: null,
                        isApproved: false, joined: Date.now(),
                        followers: [], following: [],
                        bio: "New user.", posts: []
                    };
                    users.push(newUser);
                    DB.saveUsers(users);
                    UI.notify("Account created. Waiting for admin approval.", "success");
                    Auth.toggleMode();
                } else {
                    const user = users.find(x => x.username.toLowerCase() === u.toLowerCase() && x.password === p);
                    if (!user) { err.innerText = "Invalid credentials"; err.classList.remove('hidden'); return; }
                    if (user.isBanned) { err.innerText = "Account Suspended"; err.classList.remove('hidden'); return; }
                    if (!user.isApproved) { err.innerText = "Approval Pending"; err.classList.remove('hidden'); return; }
                    
                    Auth.currentUser = user;
                    Auth.login();
                }
            },

            login: () => {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-screen').classList.remove('hidden');
                document.getElementById('sidebar-username').innerText = Auth.currentUser.username;
                document.getElementById('sidebar-avatar').innerText = Auth.currentUser.username[0].toUpperCase();
                if (Auth.currentUser.isAdmin) document.getElementById('admin-nav-section').classList.remove('hidden');
                UI.switchView('feed');
                UI.notify(`Welcome, ${Auth.currentUser.username}`, "success");
                App.startSimulation();
            },

            logout: () => { Auth.currentUser = null; location.reload(); }
        };

        // --- APP LOGIC ---
        const App = {
            simInterval: null,
            startSimulation: () => {
                if(App.simInterval) clearInterval(App.simInterval);
                const botNames = ['Bot1', 'NewsFeed', 'DailyDose', 'Clipz', 'MusicLover'];
                const phrases = ["Check out this video!", "Anyone online?", "Groups are cool.", "Just posted a new clip.", "Hello Network!"];
                App.simInterval = setInterval(() => {
                    if(Math.random() > 0.7) {
                        const posts = DB.getPosts();
                        posts.unshift({ id: 'bot_' + Date.now(), author: botNames[Math.floor(Math.random()*botNames.length)], content: phrases[Math.floor(Math.random()*phrases.length)], timestamp: Date.now(), likes: [], comments: [] });
                        if(posts.length > 50) posts.pop();
                        DB.savePosts(posts);
                        if(!document.getElementById('view-feed').classList.contains('hidden')) App.renderFeed();
                    }
                }, 8000); 
            },
            createPost: () => {
                const text = document.getElementById('post-input').value.trim();
                if (!text) return;
                const posts = DB.getPosts();
                posts.unshift({ id: 'tx_' + Date.now(), author: Auth.currentUser.username, content: text, timestamp: Date.now(), likes: [], comments: [] });
                DB.savePosts(posts);
                document.getElementById('post-input').value = '';
                UI.notify("Posted", "success");
                App.renderFeed();
            },
            renderFeed: () => {
                const container = document.getElementById('feed-container');
                const posts = DB.getPosts();
                const users = DB.getUsers();
                const visible = posts.filter(p => { const u = users.find(x => x.username === p.author); return !u || !u.isBanned; });
                container.innerHTML = visible.length ? visible.map(p => UI.postTemplate(p)).join('') : `<div class="p-10 text-center opacity-50">No posts</div>`;
            },
            renderSeameeds: () => {
                const ids = ['p7YXXieghto', 'S9IGj4dJdCg', '5qap5aO4i9A', 'tG7wLK4aAOE', 'L_jWHffIx5E', 'y7e-GC6oGhg'];
                const list = [...ids, ...ids];
                document.getElementById('seameed-grid').innerHTML = list.sort(()=>0.5-Math.random()).map(id => `<div class="video-card bg-slate-900 rounded-[2rem] overflow-hidden aspect-[9/16] shadow-xl relative"><iframe class="w-full h-full" src="https://www.youtube.com/embed/${id}?controls=0&mute=1&loop=1" frameborder="0" allowfullscreen></iframe></div>`).join('');
            },
            likePost: (id) => {
                const posts = DB.getPosts(); const p = posts.find(x => x.id === id);
                if (p.likes.includes(Auth.currentUser.username)) p.likes = p.likes.filter(u => u !== Auth.currentUser.username); else p.likes.push(Auth.currentUser.username);
                DB.savePosts(posts);
                if (!document.getElementById('view-feed').classList.contains('hidden')) App.renderFeed();
            },
            followUser: (target) => {
                const users = DB.getUsers(); const me = users.find(u => u.username === Auth.currentUser.username); const t = users.find(u => u.username === target);
                if (me.following.includes(target)) { me.following = me.following.filter(x => x !== target); t.followers = t.followers.filter(x => x !== Auth.currentUser.username); }
                else { me.following.push(target); t.followers.push(Auth.currentUser.username); }
                DB.saveUsers(users); Auth.currentUser = me; UI.showProfile(target);
            },
            search: (q) => {
                const res = document.getElementById('search-results');
                if(!q || q.length < 2) { res.innerHTML=''; return; }
                const users = DB.getUsers().filter(u => !u.isBanned && u.isApproved && u.username.toLowerCase().includes(q.toLowerCase()));
                res.innerHTML = users.map(u => `<div onclick="UI.showProfile('${u.username}'); UI.toggleSearch(false)" class="bg-card p-6 rounded-xl border border-slate-700 hover:border-primary cursor-pointer flex items-center gap-4"><div class="w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center font-bold text-white">${u.username[0]}</div><span class="font-bold">${u.username}</span></div>`).join('');
            }
        };

        // --- GROUP LOGIC ---
        const Group = {
            activeGroupId: null,
            activeChannelName: null,

            showCreateModal: () => {
                const name = prompt("Enter Group Name:");
                if (!name) return;
                const isPrivate = confirm("Is this group Private? (Requires Code)");
                let code = null;
                if (isPrivate) code = prompt("Set a Secret Code for entry:");
                const channelsStr = prompt("Enter channels separated by comma (e.g. Facts,Food,Toys):", "general");
                const channels = channelsStr.split(',').map(c => ({ name: c.trim().toLowerCase(), messages: [] }));
                
                const newGroup = {
                    id: 'grp_' + Date.now(),
                    name: name,
                    owner: Auth.currentUser.username,
                    isPrivate: isPrivate,
                    code: code,
                    members: [Auth.currentUser.username],
                    channels: channels
                };
                
                const groups = DB.getGroups();
                groups.push(newGroup);
                DB.saveGroups(groups);
                UI.notify("Group Created!", "success");
                Group.renderMyGroups();
            },

            showJoinModal: () => {
                const groups = DB.getGroups();
                // Simple prompt for now, could be a modal
                const allNames = groups.map(g => `${g.name} (${g.isPrivate ? 'Private' : 'Public'})`).join('\n');
                const nameToJoin = prompt(`Enter exact name of group to join:\n\n${allNames}`);
                if (!nameToJoin) return;
                
                const group = groups.find(g => g.name.toLowerCase() === nameToJoin.toLowerCase());
                if (!group) return UI.notify("Group not found", "danger");
                
                if (group.members.includes(Auth.currentUser.username)) return UI.notify("Already a member", "danger");
                
                if (group.isPrivate) {
                    const inputCode = prompt("Enter Access Code:");
                    if (inputCode !== group.code) return UI.notify("Invalid Code", "danger");
                }
                
                group.members.push(Auth.currentUser.username);
                DB.saveGroups(groups);
                UI.notify(`Joined ${group.name}!`, "success");
                Group.renderMyGroups();
            },

            renderMyGroups: () => {
                const list = document.getElementById('groups-list');
                const groups = DB.getGroups().filter(g => g.members.includes(Auth.currentUser.username));
                list.innerHTML = groups.map(g => `
                    <div onclick="Group.selectGroup('${g.id}')" class="p-3 hover:bg-slate-800/50 cursor-pointer rounded-lg flex items-center gap-3 transition ${Group.activeGroupId === g.id ? 'bg-slate-800' : ''}">
                        <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center font-bold text-white shrink-0">${g.name[0]}</div>
                        <div class="truncate font-bold text-sm text-slate-300">${g.name}</div>
                    </div>
                `).join('');
            },

            selectGroup: (id) => {
                Group.activeGroupId = id;
                const group = DB.getGroups().find(g => g.id === id);
                document.getElementById('group-empty-state').classList.add('hidden');
                document.getElementById('group-channels-pane').classList.remove('hidden');
                document.getElementById('group-channels-pane').classList.add('flex');
                document.getElementById('active-group-name').innerText = group.name;
                
                // Select first channel by default
                Group.activeChannelName = group.channels[0].name;
                Group.renderChannels();
                Group.renderChat();
                Group.renderMyGroups(); // Re-render to highlight active
            },

            renderChannels: () => {
                const group = DB.getGroups().find(g => g.id === Group.activeGroupId);
                const list = document.getElementById('group-channels-list');
                list.innerHTML = group.channels.map(c => `
                    <div onclick="Group.selectChannel('${c.name}')" class="px-3 py-2 rounded-lg cursor-pointer flex items-center gap-2 hover:bg-slate-800/50 transition ${Group.activeChannelName === c.name ? 'bg-slate-800 text-white' : 'text-slate-400'}">
                        <span class="text-slate-500">#</span>
                        <span class="font-bold text-sm">${c.name}</span>
                    </div>
                `).join('');
            },

            selectChannel: (name) => {
                Group.activeChannelName = name;
                Group.renderChannels();
                Group.renderChat();
            },

            renderChat: () => {
                const area = document.getElementById('group-chat-area');
                area.classList.remove('hidden');
                document.getElementById('active-channel-name').innerText = Group.activeChannelName;
                
                const group = DB.getGroups().find(g => g.id === Group.activeGroupId);
                const channel = group.channels.find(c => c.name === Group.activeChannelName);
                
                const container = document.getElementById('group-messages');
                container.innerHTML = channel.messages.map(m => `
                    <div class="flex gap-3 items-start">
                        <div class="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center font-bold text-xs shrink-0">${m.user[0]}</div>
                        <div>
                            <div class="flex gap-2 items-baseline">
                                <span class="font-bold text-white text-sm hover:underline cursor-pointer" onclick="UI.showProfile('${m.user}')">${m.user}</span>
                                <span class="text-[10px] text-slate-500">${new Date(m.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>
                            </div>
                            <p class="text-slate-300 text-sm">${m.text}</p>
                        </div>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
            },

            sendMessage: () => {
                const inp = document.getElementById('group-input');
                const text = inp.value.trim();
                if (!text || !Group.activeGroupId) return;
                
                const groups = DB.getGroups();
                const group = groups.find(g => g.id === Group.activeGroupId);
                const channel = group.channels.find(c => c.name === Group.activeChannelName);
                
                channel.messages.push({ user: Auth.currentUser.username, text: text, time: Date.now() });
                DB.saveGroups(groups);
                inp.value = '';
                Group.renderChat();
            },
            
            deleteGroup: (id) => {
                if(!confirm("Admin: Delete this group?")) return;
                let groups = DB.getGroups().filter(g => g.id !== id);
                DB.saveGroups(groups);
                Admin.init();
                UI.notify("Group Deleted", "success");
            }
        };

        // --- CHAT LOGIC ---
        const Chat = {
            activeId: null, isGroupMode: false, selectedUsers: [],
            init: () => { Chat.renderDirectory(); },
            toggleGroupMode: () => { Chat.isGroupMode = !Chat.isGroupMode; document.getElementById('chat-group-confirm').classList.toggle('hidden', !Chat.isGroupMode); Chat.renderDirectory(); },
            renderDirectory: () => {
                const list = document.getElementById('chat-user-list');
                const users = DB.getUsers().filter(u => u.username !== Auth.currentUser.username && !u.isBanned && u.isApproved);
                list.innerHTML = users.map(u => `<div onclick="Chat.handleUserClick('${u.username}')" class="p-3 hover:bg-slate-800/30 cursor-pointer flex gap-3 ${Chat.selectedUsers.includes(u.username)?'bg-indigo-900/30':''}"><div class="w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center text-xs font-bold">${u.username[0]}</div><span class="font-bold text-sm">${u.username}</span></div>`).join('');
                document.getElementById('selected-group-users').innerHTML = Chat.selectedUsers.map(u=>`<span class="bg-indigo-600 text-white text-[10px] px-2 rounded">${u}</span>`).join('');
            },
            handleUserClick: (u) => { if(Chat.isGroupMode) { if(Chat.selectedUsers.includes(u)) Chat.selectedUsers=Chat.selectedUsers.filter(x=>x!==u); else Chat.selectedUsers.push(u); Chat.renderDirectory(); } else Chat.startConversation([u]); },
            startGroup: () => { if(Chat.selectedUsers.length) Chat.startConversation(Chat.selectedUsers); },
            startConversation: (parts) => {
                const all = [...new Set([Auth.currentUser.username, ...parts])].sort();
                const chats = DB.getChats();
                let chat = chats.find(c => JSON.stringify(c.participants.sort()) === JSON.stringify(all));
                if(!chat) { chat = { id: 'dm_'+Date.now(), participants: all, messages: [], isGroup: all.length > 2 }; chats.push(chat); DB.saveChats(chats); }
                Chat.activeId = chat.id; Chat.renderActiveWindow();
            },
            renderActiveWindow: () => {
                const chat = DB.getChats().find(c => c.id === Chat.activeId);
                document.getElementById('chat-empty-state').classList.add('hidden'); document.getElementById('chat-active-window').classList.remove('hidden');
                document.getElementById('chat-target-name').innerText = chat.isGroup ? 'Group Chat' : chat.participants.find(p=>p!==Auth.currentUser.username);
                const cont = document.getElementById('chat-messages-container');
                cont.innerHTML = chat.messages.map(m => `<div class="mb-2 ${m.sender===Auth.currentUser.username?'text-right':''}"><div class="inline-block p-3 rounded-xl ${m.sender===Auth.currentUser.username?'bg-indigo-600 text-white':'bg-slate-800 text-slate-200'} text-sm">${m.text}</div></div>`).join('');
            },
            sendMessage: () => {
                const inp = document.getElementById('chat-input'); if(!inp.value.trim()) return;
                const chats = DB.getChats(); const chat = chats.find(c => c.id === Chat.activeId);
                chat.messages.push({ sender: Auth.currentUser.username, text: inp.value.trim(), time: Date.now() });
                DB.saveChats(chats); inp.value=''; Chat.renderActiveWindow();
            }
        };

        // --- ADMIN LOGIC ---
        const Admin = {
            init: () => {
                if (!Auth.currentUser.isAdmin) return;
                const users = DB.getUsers(); const posts = DB.getPosts(); const groups = DB.getGroups();
                document.getElementById('pending-count').innerText = users.filter(u=>!u.isApproved).length;
                document.getElementById('admin-approvals-list').innerHTML = users.filter(u=>!u.isApproved).map(u => `<div class="flex justify-between p-3 bg-slate-900 rounded border border-slate-800"><span>${u.username}</span><div><button onclick="Admin.approveUser('${u.username}')" class="text-green-500 mr-2">Approve</button><button onclick="Admin.deleteUser('${u.username}')" class="text-red-500">Deny</button></div></div>`).join('');
                document.getElementById('admin-user-list').innerHTML = users.map(u => `<div class="p-3 flex justify-between"><span>${u.username} ${u.isAdmin?'(Admin)':''} ${u.isBanned?'(Banned)':''}</span>${!u.isAdmin ? `<button onclick="Admin.toggleBan('${u.username}')" class="text-xs text-red-400">${u.isBanned?'Unban':'Ban'}</button>` : ''}</div>`).join('');
                
                // Group Management
                document.getElementById('admin-groups-list').innerHTML = groups.map(g => `
                    <div class="flex justify-between p-3 bg-slate-900 rounded border border-slate-800">
                        <div>
                            <span class="font-bold text-white text-sm">${g.name}</span>
                            <span class="text-[10px] text-slate-500 ml-2">${g.isPrivate ? `Private (Code: ${g.code})` : 'Public'}</span>
                        </div>
                        <button onclick="Group.deleteGroup('${g.id}')" class="text-red-500 text-xs font-bold">Delete</button>
                    </div>
                `).join('');
            },
            approveUser: (u) => { const users = DB.getUsers(); users.find(x=>x.username===u).isApproved=true; DB.saveUsers(users); Admin.init(); },
            toggleBan: (u) => { const users = DB.getUsers(); const user = users.find(x=>x.username===u); user.isBanned = !user.isBanned; user.banExpires = user.isBanned ? 'PERM' : null; DB.saveUsers(users); Admin.init(); },
            deleteUser: (u) => { const users = DB.getUsers().filter(x=>x.username!==u); DB.saveUsers(users); Admin.init(); },
            wipeAllData: () => { if(confirm("NUKE EVERYTHING?")) { const admin=DB.getUsers().find(u=>u.isAdmin); DB.saveUsers([admin]); DB.savePosts([]); DB.saveChats([]); DB.saveGroups([]); Admin.init(); } }
        };

        // --- UI UTILS ---
        const UI = {
            notify: (msg, type) => { const div = document.getElementById('notification-container'); div.innerHTML += `<div class="p-3 rounded bg-slate-800 border border-${type==='success'?'green':'red'}-500 text-white shadow-lg">${msg}</div>`; setTimeout(()=>div.innerHTML='', 3000); },
            switchView: (view) => {
                document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
                if (view === 'admin') Admin.init();
                if (view === 'feed') App.renderFeed();
                if (view === 'seameed') App.renderSeameeds();
            },
            showProfile: (u) => { UI.switchView('profile'); document.getElementById('profile-username').innerText = u; const user = DB.getUsers().find(x=>x.username===u); document.getElementById('count-followers').innerText = user.followers.length; },
            toggleProfileTab: (t) => { document.getElementById('profile-posts').innerHTML = t==='posts' ? 'User posts...' : 'User media...'; },
            toggleSearch: (s) => { document.getElementById('search-panel').classList.toggle('-translate-y-full', !s); },
            postTemplate: (p) => `<div class="bg-card p-6 rounded-2xl border border-slate-700/50 mb-4"><div class="flex gap-4"><div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-bold text-white cursor-pointer" onclick="UI.showProfile('${p.author}')">${p.author[0]}</div><div><h4 class="font-bold text-white">${p.author}</h4><p class="text-slate-300 mt-1">${p.content}</p></div></div><div class="mt-4 flex gap-4"><button onclick="App.likePost('${p.id}')" class="text-slate-500 hover:text-pink-500"><i class="ph-bold ph-heart"></i> ${p.likes.length}</button></div></div>`
        };
    </script>
</body>
</html>
